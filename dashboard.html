<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigiCard Dashboard</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .container {
            max-width: 500px;
            margin: auto;
            background: #222;
            padding: 20px;
            border-radius: 10px;
        }
        .highlight {
            color: gold;
            font-size: 1.5em;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Welcome, <span id="userName">Loading...</span>!</h2>
    <p><span class="highlight">Balance: <span id="balance">Loading...</span> DigiCredits</span></p>
    <hr>
    <h3>Card Details</h3>
    <p><strong>Card Number:</strong> <span id="cardNumber">Loading...</span></p>
    <p><strong>Expiry:</strong> <span id="expiry">Loading...</span></p>
    <p><strong>CVC:</strong> <span id="cvc">Loading...</span></p>
    <hr>

    <div id="platinumFeatures" style="display: none;">
        <h3>Platinum Features</h3>
        <p><strong>Cashback:</strong> <span id="cashback">Loading...</span></p>
        <p><strong>Credit Score:</strong> <span id="creditScore">Loading...</span></p>
        <p><strong>Debt Due:</strong> <span id="debtDue">Loading...</span> / <span id="maxDebt">Loading...</span> DigiCredits</p>
        <p><strong>Debt Due Date:</strong> <span id="debtDueDate">Loading...</span></p>
    </div>

    <div id="errorMessage" class="error" style="display: none;">
        ‚ùå Error fetching data. Please check your connection or contact support.
    </div>
</div>

<script>
    async function fetchCardData() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const cardId = urlParams.get('cardId');
            console.log("üîç Fetching data for card ID:", cardId);

            if (!cardId) {
                throw new Error("Card ID is missing in the URL!");
            }

            const apiUrl = `https://script.google.com/macros/s/AKfycbwI_d8Vx9sOuxqFlF-NXML6aoWj4JsXwRavkmvjR_P9Ho1wF2KYHfAeD6nSzcoPtiO4/exec?cardId=${cardId}`;
            console.log("üåç API URL:", apiUrl);

            const response = await fetch(apiUrl);
            const data = await response.json();
            console.log("üìä Fetched Data:", data);

            if (!data || Object.keys(data).length === 0) {
                throw new Error("No data found for this card.");
            }

            // Update Dashboard
            document.getElementById("userName").textContent = data.name || "Unknown";
            document.getElementById("balance").textContent = data.balance || "0";
            document.getElementById("cardNumber").textContent = data.cardNumber || "N/A";
            document.getElementById("expiry").textContent = data.expiry || "N/A";
            document.getElementById("cvc").textContent = data.cvc || "N/A";

            if (data.type === "Platinum") {
                document.getElementById("platinumFeatures").style.display = "block";
                document.getElementById("cashback").textContent = data.cashback || "0";
                document.getElementById("creditScore").textContent = data.creditScore || "N/A";
                document.getElementById("debtDue").textContent = data.debtDue || "0";
                document.getElementById("maxDebt").textContent = data.maxDebt || "0";
                document.getElementById("debtDueDate").textContent = data.debtDueDate || "N/A";
            }

        } catch (error) {
            console.error("üö® Fetch error:", error);
            document.getElementById("errorMessage").style.display = "block";
        }
    }

    fetchCardData();
</script>

</body>
</html>

