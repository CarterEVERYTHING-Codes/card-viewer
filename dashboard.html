<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .dashboard {
            background: #111;
            padding: 20px;
            border-radius: 10px;
            width: 50%;
            margin: auto;
            margin-top: 50px;
            box-shadow: 0px 0px 10px #444;
        }
        h1 {
            color: cyan;
        }
        h2 {
            color: gold;
        }
        .card-details, .platinum-features {
            margin-top: 20px;
            border-top: 1px solid #555;
            padding-top: 10px;
        }
        .error {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <div class="dashboard">
        <h1>Welcome, <span id="userName">Loading...</span>!</h1>
        <h2>Balance: <span id="balance">Loading...</span></h2>

        <div class="card-details">
            <h3>Card Details</h3>
            <p><strong>Card Number:</strong> <span id="cardNumber">Loading...</span></p>
            <p><strong>Expiry:</strong> <span id="expiry">Loading...</span></p>
            <p><strong>CVC:</strong> <span id="cvc">Loading...</span></p>
        </div>

        <div class="platinum-features">
            <h3>Platinum Features</h3>
            <p><strong>Cashback:</strong> <span id="cashback">Loading...</span></p>
            <p><strong>Credit Score:</strong> <span id="creditScore">Loading...</span></p>
            <p><strong>Debt Due:</strong> <span id="debtDue">Loading...</span></p>
            <p><strong>Debt Due Date:</strong> <span id="debtDueDate">Loading...</span></p>
        </div>

        <p id="errorMessage" class="error"></p>
    </div>

    <script>
        async function fetchCardData() {
            const cardId = getCardIdFromURL();
            console.log("üì° Fetching data for card:", cardId);
            
            if (!cardId) {
                console.error("üö® Card ID is missing from the URL!");
                document.getElementById("errorMessage").innerText = "‚ùå Error: Card ID is missing!";
                return;
            }

            const apiUrl = `https://script.google.com/macros/s/AKfycbw2EKEENVg1lwg3nLg8rzSU74_iQPu05NVM1nnFTuvKzUymvcV4XD1XnSIWQRUaU5Ku/exec?cardId=${cardId}`;
            console.log("üåç API URL:", apiUrl);

            try {
                const response = await fetch(apiUrl);
                const text = await response.text();
                console.log("üìÑ Raw Response:", text);

                let data = JSON.parse(text);
                console.log("üìä Fetched Data:", data);

                // If data is an array, extract the first object
                if (Array.isArray(data) && data.length > 0) {
                    data = data[0]; // Get the first object in the array
                }

                // Update the dashboard with fetched data
                document.getElementById("userName").innerText = data.name || "Unknown";
                document.getElementById("balance").innerText = data.balance ? `${data.balance} DigiCredits` : "0 DigiCredits";
                document.getElementById("cardNumber").innerText = data.cardNumber || "N/A";
                document.getElementById("expiry").innerText = data.expiry || "N/A";
                document.getElementById("cvc").innerText = data.cvc || "N/A";

                // Platinum Features
                document.getElementById("cashback").innerText = data.cashback || "N/A";
                document.getElementById("creditScore").innerText = data.creditScore || "N/A";
                document.getElementById("debtDue").innerText = data.debtDue ? `${data.debtDue} / ${data.maxCreditDebt} DigiCredits` : "N/A";
                document.getElementById("debtDueDate").innerText = data.debtDueDate || "N/A";

            } catch (error) {
                console.error("üö® Fetch error:", error);
                document.getElementById("errorMessage").innerText = "‚ùå Error fetching data. Please check your connection or contact support.";
            }
        }

        function getCardIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get("cardId");
        }

        fetchCardData();
    </script>

</body>
</html>

