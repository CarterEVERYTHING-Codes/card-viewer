<!DOCTYPE html>
<html>
<head>
    <title>Card Verification</title>
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }

        body {
            font-family: 'Josefin Sans', sans-serif;
            background-color: #000;
            color: #fff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }
        #loading {
            display: none;
            font-size: 18px;
            color: #00d4ff;
            margin-bottom: 15px;
        }
        #cvcForm {
            background-color: #111;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 255, 255, 0.2);
            width: 320px;
            text-align: center;
        }
        h2 {
            color: #00d4ff;
            margin-bottom: 20px;
        }
        label {
            font-size: 16px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #00d4ff;
            border-radius: 5px;
            background-color: #222;
            color: #fff;
            transition: 0.2s;
        }
        input.shake {
            animation: shake 0.3s ease-in-out;
            border-color: red;
        }
        button {
            background-color: #ffcc00;
            color: #000;
            padding: 10px;
            width: 100%;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: 0.3s;
        }
        button:hover {
            background-color: #ffdb4d;
        }
        button:disabled {
            background-color: #888;
            cursor: not-allowed;
        }
        #cvcError {
            color: red;
            margin-top: 10px;
            display: none;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <div id="loading">üîÑ Loading...</div>

    <div id="cvcForm">
        <h2>üîí Enter Your CVC</h2>
        <label for="cvcInput">CVC Code:</label>
        <input type="password" id="cvcInput" maxlength="3">
        <button id="verifyButton">Verify</button> 
        <p id="cvcError">‚ùå Incorrect CVC.</p>
    </div>

<script>
    let cardData;

    function getCardIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('cardId');
    }

    function verifyCVC() {
        const cvcInput = document.getElementById('cvcInput');
        const verifyButton = document.getElementById('verifyButton');
        const cvcError = document.getElementById('cvcError');

        if (!cardData) {
            console.error("Card data not loaded. Cannot verify CVC.");
            return;
        }

        verifyButton.disabled = true;
        verifyButton.textContent = "Verifying...";

        setTimeout(() => {
            if (cvcInput.value === cardData['CVC']) {
                window.location.href = `dashboard.html?cardId=${getCardIdFromUrl()}`;
            } else {
                cvcError.style.display = 'block';
                cvcInput.classList.add('shake');

                setTimeout(() => {
                    cvcInput.classList.remove('shake');
                    verifyButton.disabled = false;
                    verifyButton.textContent = "Verify";
                }, 600);
            }
        }, 1000); // Simulating delay for realism
    }

    function fetchCardData() {
        const cardId = getCardIdFromUrl();
        if (!cardId) {
            alert("Card ID missing from URL!");
            return;
        }

        const sheetUrl = 'https://script.google.com/macros/s/AKfycbzSY-F7-I9yh_b7Vh_EkyH1esb_J-DmbYm-k9dIed2GQ7Us9QYxXcySwbpJW0AyPzgD/exec';

        document.getElementById('loading').style.display = 'block';

        fetch(sheetUrl)
            .then(response => response.json())
            .then(data => {
                cardData = data.find(item => item['cardId'] === cardId);
                document.getElementById('loading').style.display = 'none';

                if (!cardData) {
                    alert("Card not found!");
                }
            })
            .catch(error => {
                console.error("Error fetching card data:", error);
                document.getElementById('loading').style.display = 'none';
            });
    }

    document.getElementById('verifyButton').addEventListener('click', verifyCVC);

    fetchCardData();
</script>

</body>
</html>
